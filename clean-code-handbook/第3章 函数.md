# 第3章 函数

## 3.1 短小

函数的第一条规则是要短小。

尽量减少函数的缩进层级，不要过多地嵌套if、else、for、while

## 3.2 只做一件事

> 函数应该做一件事。做好这件事。只做这一件事。

一件事的判断标准：函数只做该函数名下同一抽象层上的步骤。

另一种判断方法：是否能再拆出一个函数，该函数不仅只是单纯地重新诠释其实现。

只做一件事的函数无法被合理地切分为多个区段。

## 3.3 每个函数一个抽象层级

#### 自顶向下读代码：向下规则

> 程序就像是一系列TO起头的段落，每一段都描述当前抽象层级，并引用位于下一抽象层级的后续TO起头段落。

## 3.4 switch语句

> 如果switch语句只出现一次，用于创建多态对象，而且隐藏在某个继承关系中，在系统其它部分看不到，则还可容忍。

## 3.5 使用描述性名称

> 沃德原则：如果每个例程都让你感到深合己意，那就是整洁代码

函数越短小、功能越集中，就越便于取个好名字。

* 长而具有描述性的名称，要比短而令人费解的名称好
* 长而具有描述性的名称，要比描述性的长注释好

选择描述性的名称能理清关于模块的设计思路，并进行改进。

命名方式要保持一致，使用与模块名一脉相承的短语、名次和动词给函数命名。

## 3.6 函数参数

应尽量避免参数数量多于三个，最理想的参数数量是零。

从测试的角度看，参数越多，测试用例的组合就越多。

### 3.6.1 一元函数的普遍形式

向函数传入单个参数的理由：

1. 向函数询问关于那个参数的问题
   1. `boolean fileExists("MyFile")`
2. 操作该参数，将其转换为其他东西
   1. `InputStream fileOpen("MyFile")`
3. 事件：使用参数修改系统状态

尽量避免输出参数的存在。

### 3.6.2 标识参数

向函数传入表示标识的布尔值，会破坏函数的单一职责原则，导致函数不只做一件事。

在有必要的情况下，比如两件事关联程度不大，则应将此函数拆分为两个函数。

### 3.6.3 二元函数

二元函数的两个参数之间如果没有特定的顺序含义，则往往容易被弄混，或忽略其中一个参数。

### 3.6.4 三元函数

三元函数参数的排序、琢磨、忽略的问题都会加倍体现。

### 3.6.5 参数对象

如果函数看来需要两个、三个或三个以上参数，就说明其中一些参数应该封装为类/结构体。

### 3.6.6 参数列表

参数列表可看作是一个参数。

### 3.6.7 动词与关键字

一元函数，函数名和参数应当形成一种非常良好的动词/名词对形式，或者动宾短语形式。

有些函数可在函数名中加入关键字，体现参数的顺序。

## 3.7 无副作用

#### 输出参数

面向对象语言中，尽可能将采用输出参数的函数变为该输出参数对应的类的一个方法。

## 3.8 分隔指令与询问

读写分离。

函数或者做一些事情（写），或者回答一些事情（读）。

## 3.9 使用异常替代返回错误码

返回错误码导致更深层次的嵌套结构，当返回错误码时，就是在要求调用者立刻处理错误。

采用异常处理，错误处理代码就能从主路径代码中分离，得到简化。

### 3.9.1 抽离try/catch代码块

最好将try/catch代码块的主体进行封装，使得代码简洁。

### 3.9.2 错误处理就是一件事

处理错误的函数不该做其他事，真正要做的事一定要放在try块中。

### 3.9.3 Error.java依赖磁铁

返回错误码时通常暗示某处有个类或是枚举，定义了所有错误码。

当Error枚举修改时，所有这些其他的类都需要重新编译和部署。

使用异常代替错误码，新异常就可以从异常类派生。

## 3.10 别重复自己

## 3.11 结构化编程

## 3.12 如何写出这样的函数

* 实现功能
* 分解函数
* 修改名称
* 消除重复

## 3.13 小结

> 每个系统都是使用某种领域特定语言搭建，而这种语言是程序员设计来描述那个系统的。函数是语言的动词、类是名词。大师级程序员把系统当作故事来讲